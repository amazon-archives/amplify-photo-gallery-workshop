<!DOCTYPE html>
<html class="no-js" lang="en-US" prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#">
<html lang="ko" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta property="og:title" content="Amplify + AppSync Workshop" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://amplify-workshop.go-aws.com" />
    <meta property="og:image" content="https://amplify-workshop.go-aws.com/images/architecture.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="generator" content="Hugo 0.54.0" />
    <meta name="description" content="Amplify / AppSync / React Workshop">
<meta name="author" content="Gabe Hollombe">

    <link rel="shortcut icon" href="https://awskrug.github.io/amplify-photo-gallery-workshop/images/favicon.png" type="image/x-icon" />
<link rel="icon" href="https://awskrug.github.io/amplify-photo-gallery-workshop/images/favicon.png" type="image/x-icon" />
    <title>Connecting the photos bucket to the processor function :: Amplify / AppSync / React Workshop</title>

    
    <link href="https://awskrug.github.io/amplify-photo-gallery-workshop/css/nucleus.css?1554115494" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/all.css" integrity="sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ" crossorigin="anonymous">
    <link href="https://awskrug.github.io/amplify-photo-gallery-workshop/css/hybrid.css?1554115494" rel="stylesheet">
    <link href="https://awskrug.github.io/amplify-photo-gallery-workshop/css/featherlight.min.css?1554115494" rel="stylesheet">
    <link href="https://awskrug.github.io/amplify-photo-gallery-workshop/css/perfect-scrollbar.min.css?1554115494" rel="stylesheet">
    <link href="https://awskrug.github.io/amplify-photo-gallery-workshop/css/auto-complete.css?1554115494" rel="stylesheet">
    <link href="https://awskrug.github.io/amplify-photo-gallery-workshop/css/theme.css?1554115494" rel="stylesheet">
    <link href="https://awskrug.github.io/amplify-photo-gallery-workshop/css/hugo-theme.css?1554115494" rel="stylesheet">
    
      <link href="https://awskrug.github.io/amplify-photo-gallery-workshop/css/theme-mine.css?1554115494" rel="stylesheet">
    

    <link href="https://awskrug.github.io/amplify-photo-gallery-workshop/css/jquery-ui.min.css?1554115494" rel="stylesheet">
    <link href="https://awskrug.github.io/amplify-photo-gallery-workshop/css/jquery-ui.structure.min.css?1554115494" rel="stylesheet">
    <link href="https://awskrug.github.io/amplify-photo-gallery-workshop/css/jquery-ui.theme.min.css?1554115494" rel="stylesheet">
    <script src="https://awskrug.github.io/amplify-photo-gallery-workshop/js/jquery-2.x.min.js?1554115494"></script>
    <script src="https://awskrug.github.io/amplify-photo-gallery-workshop/js/jquery-ui.min.js?1554115494"></script>
    <script src="https://awskrug.github.io/amplify-photo-gallery-workshop/js/tabs.js?1554115494"></script>

    <style type="text/css">
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/70_generating_thumbnails/20_connecting_the_lambda_to_the_bucket.html">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a href="https://awskrug.github.io/amplify-photo-gallery-workshop/" title="Go home"><svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 30" width="60%" style="padding:20px 0px;"><defs><style>.cls-1{fill:#fff;}.cls-2{fill:#f90;fill-rule:evenodd;}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09,10.85a4.7,4.7,0,0,0,.19,1.48,7.73,7.73,0,0,0,.54,1.19.77.77,0,0,1,.12.38.64.64,0,0,1-.32.49l-1,.7a.83.83,0,0,1-.44.15.69.69,0,0,1-.49-.23,3.8,3.8,0,0,1-.6-.77q-.25-.42-.51-1a6.14,6.14,0,0,1-4.89,2.3,4.54,4.54,0,0,1-3.32-1.19,4.27,4.27,0,0,1-1.22-3.2A4.28,4.28,0,0,1,3.61,7.75,6.06,6.06,0,0,1,7.69,6.46a12.47,12.47,0,0,1,1.76.13q.92.13,1.91.36V5.73a3.65,3.65,0,0,0-.79-2.66A3.81,3.81,0,0,0,7.86,2.3a7.71,7.71,0,0,0-1.79.22,12.78,12.78,0,0,0-1.79.57,4.55,4.55,0,0,1-.58.22l-.26,0q-.35,0-.35-.52V2a1.09,1.09,0,0,1,.12-.58,1.2,1.2,0,0,1,.47-.35A10.88,10.88,0,0,1,5.77.32,10.19,10.19,0,0,1,8.36,0a6,6,0,0,1,4.35,1.35,5.49,5.49,0,0,1,1.38,4.09ZM7.34,13.38a5.36,5.36,0,0,0,1.72-.31A3.63,3.63,0,0,0,10.63,12,2.62,2.62,0,0,0,11.19,11a5.63,5.63,0,0,0,.16-1.44v-.7a14.35,14.35,0,0,0-1.53-.28,12.37,12.37,0,0,0-1.56-.1,3.84,3.84,0,0,0-2.47.67A2.34,2.34,0,0,0,5,11a2.35,2.35,0,0,0,.61,1.76A2.4,2.4,0,0,0,7.34,13.38Zm13.35,1.8a1,1,0,0,1-.64-.16,1.3,1.3,0,0,1-.35-.65L15.81,1.51a3,3,0,0,1-.15-.67.36.36,0,0,1,.41-.41H17.7a1,1,0,0,1,.65.16,1.4,1.4,0,0,1,.33.65l2.79,11,2.59-11A1.17,1.17,0,0,1,24.39.6a1.1,1.1,0,0,1,.67-.16H26.4a1.1,1.1,0,0,1,.67.16,1.17,1.17,0,0,1,.32.65L30,12.39,32.88,1.25A1.39,1.39,0,0,1,33.22.6a1,1,0,0,1,.65-.16h1.54a.36.36,0,0,1,.41.41,1.36,1.36,0,0,1,0,.26,3.64,3.64,0,0,1-.12.41l-4,12.86a1.3,1.3,0,0,1-.35.65,1,1,0,0,1-.64.16H29.25a1,1,0,0,1-.67-.17,1.26,1.26,0,0,1-.32-.67L25.67,3.64,23.11,14.34a1.26,1.26,0,0,1-.32.67,1,1,0,0,1-.67.17Zm21.36.44a11.28,11.28,0,0,1-2.56-.29,7.44,7.44,0,0,1-1.92-.67,1,1,0,0,1-.61-.93v-.84q0-.52.38-.52a.9.9,0,0,1,.31.06l.42.17a8.77,8.77,0,0,0,1.83.58,9.78,9.78,0,0,0,2,.2,4.48,4.48,0,0,0,2.43-.55,1.76,1.76,0,0,0,.86-1.57,1.61,1.61,0,0,0-.45-1.16A4.29,4.29,0,0,0,43,9.22l-2.41-.76A5.15,5.15,0,0,1,38,6.78a3.94,3.94,0,0,1-.83-2.41,3.7,3.7,0,0,1,.45-1.85,4.47,4.47,0,0,1,1.19-1.37A5.27,5.27,0,0,1,40.51.29,7.4,7.4,0,0,1,42.6,0a8.87,8.87,0,0,1,1.12.07q.57.07,1.08.19t.95.26a4.27,4.27,0,0,1,.7.29,1.59,1.59,0,0,1,.49.41.94.94,0,0,1,.15.55v.79q0,.52-.38.52a1.76,1.76,0,0,1-.64-.2,7.74,7.74,0,0,0-3.2-.64,4.37,4.37,0,0,0-2.21.47,1.6,1.6,0,0,0-.79,1.48,1.58,1.58,0,0,0,.49,1.18,4.94,4.94,0,0,0,1.83.92L44.55,7a5.08,5.08,0,0,1,2.57,1.6A3.76,3.76,0,0,1,47.9,11a4.21,4.21,0,0,1-.44,1.93,4.4,4.4,0,0,1-1.21,1.47,5.43,5.43,0,0,1-1.85.93A8.25,8.25,0,0,1,42.05,15.62Z"></path><path class="cls-2" d="M45.19,23.81C39.72,27.85,31.78,30,25,30A36.64,36.64,0,0,1,.22,20.57c-.51-.46-.06-1.09.56-.74A49.78,49.78,0,0,0,25.53,26.4,49.23,49.23,0,0,0,44.4,22.53C45.32,22.14,46.1,23.14,45.19,23.81Z"></path><path class="cls-2" d="M47.47,21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74,3.13-2.2,8.27-1.57,8.86-.83s-.16,5.89-3.09,8.35c-.45.38-.88.18-.68-.32C46.69,25.8,48.17,22.11,47.47,21.21Z"></path></svg></a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fa fa-search"></i></label>
    <input data-search-input id="search-by" type="text" placeholder="">
    <span data-search-clear=""><i class="fa fa-close"></i></span>
</div>

<script type="text/javascript" src="https://awskrug.github.io/amplify-photo-gallery-workshop/js/lunr.min.js?1554115494"></script>
<script type="text/javascript" src="https://awskrug.github.io/amplify-photo-gallery-workshop/js/auto-complete.js?1554115494"></script>
<script type="text/javascript">
    
        var baseurl = '\/';
    
</script>
<script type="text/javascript" src="https://awskrug.github.io/amplify-photo-gallery-workshop/js/search.js?1554115494"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          


 
  
    
    <li data-nav-id="/10_%EC%82%AC%EC%A0%84%EC%A4%80%EB%B9%84.html" title="사전준비" class="dd-item 
        
        
        
        ">
      <a href="https://awskrug.github.io/amplify-photo-gallery-workshop/10_%EC%82%AC%EC%A0%84%EC%A4%80%EB%B9%84.html">
          사전준비
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/10_%EC%82%AC%EC%A0%84%EC%A4%80%EB%B9%84/1_account.html" title="AWS account 생성하기" class="dd-item ">
        <a href="https://awskrug.github.io/amplify-photo-gallery-workshop/10_%EC%82%AC%EC%A0%84%EC%A4%80%EB%B9%84/1_account.html">
        AWS account 생성하기
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/10_%EC%82%AC%EC%A0%84%EC%A4%80%EB%B9%84/10_workspace.html" title="Cloud9 Workspace 생성하기" class="dd-item ">
        <a href="https://awskrug.github.io/amplify-photo-gallery-workshop/10_%EC%82%AC%EC%A0%84%EC%A4%80%EB%B9%84/10_workspace.html">
        Cloud9 Workspace 생성하기
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/10_%EC%82%AC%EC%A0%84%EC%A4%80%EB%B9%84/20_software.html" title="설치 &amp; 설정" class="dd-item ">
        <a href="https://awskrug.github.io/amplify-photo-gallery-workshop/10_%EC%82%AC%EC%A0%84%EC%A4%80%EB%B9%84/20_software.html">
        설치 &amp; 설정
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/20_getting_started.html" title="Getting Started" class="dd-item 
        
        
        
        ">
      <a href="https://awskrug.github.io/amplify-photo-gallery-workshop/20_getting_started.html">
          Getting Started
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/20_getting_started/10_what_we_will_build.html" title="What We&#39;ll Build" class="dd-item ">
        <a href="https://awskrug.github.io/amplify-photo-gallery-workshop/20_getting_started/10_what_we_will_build.html">
        What We&#39;ll Build
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/20_getting_started/20_bootstrapping_the_app.html" title="Bootstrapping the App" class="dd-item ">
        <a href="https://awskrug.github.io/amplify-photo-gallery-workshop/20_getting_started/20_bootstrapping_the_app.html">
        Bootstrapping the App
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/30_adding_auth.html" title="Adding Authentication" class="dd-item 
        
        
        
        ">
      <a href="https://awskrug.github.io/amplify-photo-gallery-workshop/30_adding_auth.html">
          Adding Authentication
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/30_adding_auth/10_adding_auth_back.html" title="Setting Up the Back End" class="dd-item ">
        <a href="https://awskrug.github.io/amplify-photo-gallery-workshop/30_adding_auth/10_adding_auth_back.html">
        Setting Up the Back End
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/30_adding_auth/20_adding_auth_front.html" title="Rendering the Front End" class="dd-item ">
        <a href="https://awskrug.github.io/amplify-photo-gallery-workshop/30_adding_auth/20_adding_auth_front.html">
        Rendering the Front End
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/40_graphql.html" title="Creating a GraphQL API" class="dd-item 
        
        
        
        ">
      <a href="https://awskrug.github.io/amplify-photo-gallery-workshop/40_graphql.html">
          Creating a GraphQL API
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/40_graphql/10_setting_up_appsync.html" title="Setting Up AppSync" class="dd-item ">
        <a href="https://awskrug.github.io/amplify-photo-gallery-workshop/40_graphql/10_setting_up_appsync.html">
        Setting Up AppSync
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/40_graphql/20_trying_out_queries.html" title="Trying Out Some Queries" class="dd-item ">
        <a href="https://awskrug.github.io/amplify-photo-gallery-workshop/40_graphql/20_trying_out_queries.html">
        Trying Out Some Queries
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/50_working_with_albums.html" title="Working With Albums" class="dd-item 
        
        
        
        ">
      <a href="https://awskrug.github.io/amplify-photo-gallery-workshop/50_working_with_albums.html">
          Working With Albums
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/50_working_with_albums/5_managing_albums.html" title="Managing Albums" class="dd-item ">
        <a href="https://awskrug.github.io/amplify-photo-gallery-workshop/50_working_with_albums/5_managing_albums.html">
        Managing Albums
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/60_managing_photos.html" title="Managing Photos" class="dd-item 
        
        
        
        ">
      <a href="https://awskrug.github.io/amplify-photo-gallery-workshop/60_managing_photos.html">
          Managing Photos
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/60_managing_photos/30_adding_storage.html" title="Adding Cloud Storage" class="dd-item ">
        <a href="https://awskrug.github.io/amplify-photo-gallery-workshop/60_managing_photos/30_adding_storage.html">
        Adding Cloud Storage
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/60_managing_photos/40_upload_photos_consolidated.html" title="Managing Photos" class="dd-item ">
        <a href="https://awskrug.github.io/amplify-photo-gallery-workshop/60_managing_photos/40_upload_photos_consolidated.html">
        Managing Photos
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/70_generating_thumbnails.html" title="Generating Thumbnails" class="dd-item 
        parent
        
        
        ">
      <a href="https://awskrug.github.io/amplify-photo-gallery-workshop/70_generating_thumbnails.html">
          Generating Thumbnails
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/70_generating_thumbnails/10_creating_a_photo_processor_lambda.html" title="Creating a Photo Processor Lambda function" class="dd-item ">
        <a href="https://awskrug.github.io/amplify-photo-gallery-workshop/70_generating_thumbnails/10_creating_a_photo_processor_lambda.html">
        Creating a Photo Processor Lambda function
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/70_generating_thumbnails/20_connecting_the_lambda_to_the_bucket.html" title="Connecting the photos bucket to the processor function" class="dd-item active">
        <a href="https://awskrug.github.io/amplify-photo-gallery-workshop/70_generating_thumbnails/20_connecting_the_lambda_to_the_bucket.html">
        Connecting the photos bucket to the processor function
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/110_ai.html" title="Adding AI" class="dd-item 
        
        
        
        ">
      <a href="https://awskrug.github.io/amplify-photo-gallery-workshop/110_ai.html">
          Adding AI
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/110_ai/10_rekognition.html" title="Integrating Amazon Rekognition" class="dd-item ">
        <a href="https://awskrug.github.io/amplify-photo-gallery-workshop/110_ai/10_rekognition.html">
        Integrating Amazon Rekognition
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/110_ai/20_prep_for_searching.html" title="Making Photos Searchable" class="dd-item ">
        <a href="https://awskrug.github.io/amplify-photo-gallery-workshop/110_ai/20_prep_for_searching.html">
        Making Photos Searchable
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/110_ai/40_searching_for_labels.html" title="Searching Photos By Label" class="dd-item ">
        <a href="https://awskrug.github.io/amplify-photo-gallery-workshop/110_ai/40_searching_for_labels.html">
        Searching Photos By Label
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/120_deploying.html" title="Publishing Our App" class="dd-item 
        
        
        
        ">
      <a href="https://awskrug.github.io/amplify-photo-gallery-workshop/120_deploying.html">
          Publishing Our App
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/120_deploying/10_deploying.html" title="Deploying our app to S3" class="dd-item ">
        <a href="https://awskrug.github.io/amplify-photo-gallery-workshop/120_deploying/10_deploying.html">
        Deploying our app to S3
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/130_wrapping_up.html" title="Wrapping Up" class="dd-item 
        
        
        
        ">
      <a href="https://awskrug.github.io/amplify-photo-gallery-workshop/130_wrapping_up.html">
          Wrapping Up
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/130_wrapping_up/10_what_we_built.html" title="Congratulations!" class="dd-item ">
        <a href="https://awskrug.github.io/amplify-photo-gallery-workshop/130_wrapping_up/10_what_we_built.html">
        Congratulations!
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/130_wrapping_up/20_cleanup.html" title="Cleaning Up" class="dd-item ">
        <a href="https://awskrug.github.io/amplify-photo-gallery-workshop/130_wrapping_up/20_cleanup.html">
        Cleaning Up
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/140_bonus.html" title="Bonus Content" class="dd-item 
        
        
        
        ">
      <a href="https://awskrug.github.io/amplify-photo-gallery-workshop/140_bonus.html">
          Bonus Content
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/140_bonus/10_lightbox_photos.html" title="Making a Lightbox for Viewing Fullsize Photos" class="dd-item ">
        <a href="https://awskrug.github.io/amplify-photo-gallery-workshop/140_bonus/10_lightbox_photos.html">
        Making a Lightbox for Viewing Fullsize Photos
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/140_bonus/20_album_membership.html" title="Allowing Other Users To Collaborate In Albums" class="dd-item ">
        <a href="https://awskrug.github.io/amplify-photo-gallery-workshop/140_bonus/20_album_membership.html">
        Allowing Other Users To Collaborate In Albums
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3></h3>
        <ul>
          
              <li> 
                  <a class="padding" href="https://twitter.com/intent/user?screen_name=gabehollombe"><i class='fab fa-twitter fa-lg'></i> @gabehollombe</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="footer">
      <left>

    <h2 class="github-title">Github Repos</h2>

    <h3 class="github-title">Amplify Photo Gallery Workshop</h3>
    <a class="github-button" href="https://github.com/aws-samples/amplify-photo-gallery-workshop" data-icon="octicon-star" data-show-count="true" aria-label="Star on GitHub">Star</a>
    &nbsp;<a class="github-button" href="https://github.com/aws-samples/amplify-photo-gallery-workshop/fork" data-icon="octicon-repo-forked" data-show-count="true" aria-label="Fork on GitHub">Fork</a><br />

    <h5 class="copyright">&copy; 2018 Amazon Web Services, Inc. or its Affiliates. All rights reserved.<h5>

</left>

<script async defer src="https://buttons.github.io/buttons.js"></script> 

    </section>
  </div>
</nav>





        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fa fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fa fa-list-alt"></i></span>
                  
                  <span class="links">
                    
          
          
            
            
          
          
            
            
          
          
            <a href='https://awskrug.github.io/amplify-photo-gallery-workshop/'>Amplify Web App Workshop</a> > <a href='https://awskrug.github.io/amplify-photo-gallery-workshop/70_generating_thumbnails.html'>Generating Thumbnails</a> > Connecting the photos bucket to the processor function
          
        
          
        
          
        
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
<ul>
<li>
<ul>
<li>
<ul>
<li><a href="#triggering-the-function-when-new-photos-are-uploaded-to-the-s3-bucket">Triggering the function when new photos are uploaded to the S3 bucket</a></li>
<li><a href="#what-we-changed-in-amplify-s3-cloudformation-template-json">What we changed in amplify/&hellip;/s3-cloudformation-template.json</a></li>
<li><a href="#try-uploading-another-photo">Try uploading another photo</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            

        
        <div id="body-inner">
          
            <h1>Connecting the photos bucket to the processor function</h1>
          

        




<h3 id="triggering-the-function-when-new-photos-are-uploaded-to-the-s3-bucket">Triggering the function when new photos are uploaded to the S3 bucket</h3>

<p>Now that we&rsquo;ve created our Photo Processor function, we need to set up a trigger for it to run. Since we want to process every photo that gets uploaded to an album, we&rsquo;ll make these changes by updating the configuration of the S3 userfiles bucket that Amplify created for us.</p>

<ol>
<li><p><strong>Replace photo-albums/amplify/backend/storage/photoalbumsstorage/s3-cloudformation-template.json</strong> with the following:
<div style="height: 550px; overflow-y: scroll;">
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
	<span style="color:#f92672">&#34;AWSTemplateFormatVersion&#34;</span>: <span style="color:#e6db74">&#34;2010-09-09&#34;</span>,
	<span style="color:#f92672">&#34;Description&#34;</span>: <span style="color:#e6db74">&#34;S3 resource stack creation using Amplify CLI&#34;</span>,
	<span style="color:#f92672">&#34;Parameters&#34;</span>: {
		<span style="color:#f92672">&#34;bucketName&#34;</span>: {
			<span style="color:#f92672">&#34;Type&#34;</span>: <span style="color:#e6db74">&#34;String&#34;</span>
		},
		<span style="color:#f92672">&#34;authPolicyName&#34;</span>: {
			<span style="color:#f92672">&#34;Type&#34;</span>: <span style="color:#e6db74">&#34;String&#34;</span>
		},
		<span style="color:#f92672">&#34;unauthPolicyName&#34;</span>: {
			<span style="color:#f92672">&#34;Type&#34;</span>: <span style="color:#e6db74">&#34;String&#34;</span>
		},
		<span style="color:#f92672">&#34;authRoleName&#34;</span>: {
			<span style="color:#f92672">&#34;Type&#34;</span>: <span style="color:#e6db74">&#34;String&#34;</span>
		},
		<span style="color:#f92672">&#34;unauthRoleName&#34;</span>: {
			<span style="color:#f92672">&#34;Type&#34;</span>: <span style="color:#e6db74">&#34;String&#34;</span>
		},
		<span style="color:#f92672">&#34;unauthPermissions&#34;</span>: {
			<span style="color:#f92672">&#34;Type&#34;</span>: <span style="color:#e6db74">&#34;String&#34;</span>
		},
		<span style="color:#f92672">&#34;authPermissions&#34;</span>: {
			<span style="color:#f92672">&#34;Type&#34;</span>: <span style="color:#e6db74">&#34;String&#34;</span>
		},
<span style="display:block;width:100%;background-color:#3c3d38">		<span style="color:#f92672">&#34;env&#34;</span>: {
</span><span style="display:block;width:100%;background-color:#3c3d38">            <span style="color:#f92672">&#34;Type&#34;</span>: <span style="color:#e6db74">&#34;String&#34;</span>
</span><span style="display:block;width:100%;background-color:#3c3d38">        }
</span>
	},
	<span style="color:#f92672">&#34;Conditions&#34;</span>: {
		<span style="color:#f92672">&#34;ShouldNotCreateEnvResources&#34;</span>: {
            <span style="color:#f92672">&#34;Fn::Equals&#34;</span>: [
                {
                    <span style="color:#f92672">&#34;Ref&#34;</span>: <span style="color:#e6db74">&#34;env&#34;</span>
                },
                <span style="color:#e6db74">&#34;NONE&#34;</span>
            ]
        },
		<span style="color:#f92672">&#34;EnableUnauthReadWrite&#34;</span>: {
			<span style="color:#f92672">&#34;Fn::Equals&#34;</span>: [
				{
					<span style="color:#f92672">&#34;Ref&#34;</span>: <span style="color:#e6db74">&#34;unauthPermissions&#34;</span>
				},
				<span style="color:#e6db74">&#34;rw&#34;</span>
			]
		},
		<span style="color:#f92672">&#34;EnableUnauthRead&#34;</span>: {
			<span style="color:#f92672">&#34;Fn::Equals&#34;</span>: [
				{
					<span style="color:#f92672">&#34;Ref&#34;</span>: <span style="color:#e6db74">&#34;unauthPermissions&#34;</span>
				},
				<span style="color:#e6db74">&#34;r&#34;</span>
			]
		},
		<span style="color:#f92672">&#34;EnableUnauthWrite&#34;</span>: {
			<span style="color:#f92672">&#34;Fn::Equals&#34;</span>: [
				{
					<span style="color:#f92672">&#34;Ref&#34;</span>: <span style="color:#e6db74">&#34;unauthPermissions&#34;</span>
				},
				<span style="color:#e6db74">&#34;w&#34;</span>
			]
		},
		<span style="color:#f92672">&#34;EnableAuthReadWrite&#34;</span>: {
			<span style="color:#f92672">&#34;Fn::Equals&#34;</span>: [
				{
					<span style="color:#f92672">&#34;Ref&#34;</span>: <span style="color:#e6db74">&#34;authPermissions&#34;</span>
				},
				<span style="color:#e6db74">&#34;rw&#34;</span>
			]
		},
		<span style="color:#f92672">&#34;EnableAuthRead&#34;</span>: {
			<span style="color:#f92672">&#34;Fn::Equals&#34;</span>: [
				{
					<span style="color:#f92672">&#34;Ref&#34;</span>: <span style="color:#e6db74">&#34;authPermissions&#34;</span>
				},
				<span style="color:#e6db74">&#34;r&#34;</span>
			]
		},
		<span style="color:#f92672">&#34;EnableAuthWrite&#34;</span>: {
			<span style="color:#f92672">&#34;Fn::Equals&#34;</span>: [
				{
					<span style="color:#f92672">&#34;Ref&#34;</span>: <span style="color:#e6db74">&#34;authPermissions&#34;</span>
				},
				<span style="color:#e6db74">&#34;w&#34;</span>
			]
		}
	},
	<span style="color:#f92672">&#34;Resources&#34;</span>: {
<span style="display:block;width:100%;background-color:#3c3d38">		<span style="color:#f92672">&#34;InvokePhotoProcessorLambda&#34;</span>: {
</span><span style="display:block;width:100%;background-color:#3c3d38">			<span style="color:#f92672">&#34;Type&#34;</span> : <span style="color:#e6db74">&#34;AWS::Lambda::Permission&#34;</span>,
</span><span style="display:block;width:100%;background-color:#3c3d38">			<span style="color:#f92672">&#34;Properties&#34;</span> : {
</span><span style="display:block;width:100%;background-color:#3c3d38">				<span style="color:#f92672">&#34;Action&#34;</span> : <span style="color:#e6db74">&#34;lambda:InvokeFunction&#34;</span>,
</span><span style="display:block;width:100%;background-color:#3c3d38">				<span style="color:#f92672">&#34;FunctionName&#34;</span> : <span style="color:#e6db74">&#34;workshopphotoprocessor&#34;</span>,
</span><span style="display:block;width:100%;background-color:#3c3d38">				<span style="color:#f92672">&#34;Principal&#34;</span> : <span style="color:#e6db74">&#34;s3.amazonaws.com&#34;</span>,
</span><span style="display:block;width:100%;background-color:#3c3d38">				<span style="color:#f92672">&#34;SourceAccount&#34;</span> :  { <span style="color:#f92672">&#34;Ref&#34;</span>: <span style="color:#e6db74">&#34;AWS::AccountId&#34;</span> },
</span><span style="display:block;width:100%;background-color:#3c3d38">				<span style="color:#f92672">&#34;SourceArn&#34;</span>: <span style="color:#e6db74">&#34;arn:aws:s3:::REPLACE_WITH_USERFILES_BUCKET_NAME&#34;</span>
</span><span style="display:block;width:100%;background-color:#3c3d38">			}
</span><span style="display:block;width:100%;background-color:#3c3d38">		},
</span>		<span style="color:#f92672">&#34;S3Bucket&#34;</span>: {
			<span style="color:#f92672">&#34;Type&#34;</span>: <span style="color:#e6db74">&#34;AWS::S3::Bucket&#34;</span>,
			<span style="color:#f92672">&#34;DeletionPolicy&#34;</span> : <span style="color:#e6db74">&#34;Retain&#34;</span>,
			<span style="color:#f92672">&#34;Properties&#34;</span>: {
				<span style="color:#f92672">&#34;BucketName&#34;</span>: {
                    <span style="color:#f92672">&#34;Fn::If&#34;</span>: [
                        <span style="color:#e6db74">&#34;ShouldNotCreateEnvResources&#34;</span>,
                        {
                            <span style="color:#f92672">&#34;Ref&#34;</span>: <span style="color:#e6db74">&#34;bucketName&#34;</span>
                        },
                        {
                            <span style="color:#f92672">&#34;Fn::Join&#34;</span>: [
                                <span style="color:#e6db74">&#34;&#34;</span>,
                                [
                                    {
                                        <span style="color:#f92672">&#34;Ref&#34;</span>: <span style="color:#e6db74">&#34;bucketName&#34;</span>
                                    },
                                    <span style="color:#e6db74">&#34;-&#34;</span>,
                                    {
                                        <span style="color:#f92672">&#34;Ref&#34;</span>: <span style="color:#e6db74">&#34;env&#34;</span>
                                    }
                                ]
                            ]
                        }
                    ]
                },
				<span style="color:#f92672">&#34;CorsConfiguration&#34;</span>: {
					<span style="color:#f92672">&#34;CorsRules&#34;</span>: [
						{
							<span style="color:#f92672">&#34;AllowedHeaders&#34;</span>: [
								<span style="color:#e6db74">&#34;*&#34;</span>
							],
							<span style="color:#f92672">&#34;AllowedMethods&#34;</span>: [
								<span style="color:#e6db74">&#34;GET&#34;</span>,
								<span style="color:#e6db74">&#34;HEAD&#34;</span>,
								<span style="color:#e6db74">&#34;PUT&#34;</span>,
								<span style="color:#e6db74">&#34;POST&#34;</span>,
								<span style="color:#e6db74">&#34;DELETE&#34;</span>
							],
							<span style="color:#f92672">&#34;AllowedOrigins&#34;</span>: [
								<span style="color:#e6db74">&#34;*&#34;</span>
							],
							<span style="color:#f92672">&#34;ExposedHeaders&#34;</span>: [
								<span style="color:#e6db74">&#34;x-amz-server-side-encryption&#34;</span>,
								<span style="color:#e6db74">&#34;x-amz-request-id&#34;</span>,
								<span style="color:#e6db74">&#34;x-amz-id-2&#34;</span>
							],
							<span style="color:#f92672">&#34;Id&#34;</span>: <span style="color:#e6db74">&#34;S3CORSRuleId1&#34;</span>,
							<span style="color:#f92672">&#34;MaxAge&#34;</span>: <span style="color:#e6db74">&#34;3000&#34;</span>
						}
					]
				},
<span style="display:block;width:100%;background-color:#3c3d38">				<span style="color:#f92672">&#34;NotificationConfiguration&#34;</span>: {
</span><span style="display:block;width:100%;background-color:#3c3d38">					<span style="color:#f92672">&#34;LambdaConfigurations&#34;</span>: [
</span><span style="display:block;width:100%;background-color:#3c3d38">						{
</span><span style="display:block;width:100%;background-color:#3c3d38">							<span style="color:#f92672">&#34;Function&#34;</span>: {
</span><span style="display:block;width:100%;background-color:#3c3d38">								<span style="color:#f92672">&#34;Fn::Join&#34;</span>: [<span style="color:#e6db74">&#34;:&#34;</span>, [
</span><span style="display:block;width:100%;background-color:#3c3d38">									<span style="color:#e6db74">&#34;arn:aws:lambda&#34;</span>,
</span><span style="display:block;width:100%;background-color:#3c3d38">									{ <span style="color:#f92672">&#34;Ref&#34;</span>: <span style="color:#e6db74">&#34;AWS::Region&#34;</span> },
</span><span style="display:block;width:100%;background-color:#3c3d38">									{ <span style="color:#f92672">&#34;Ref&#34;</span>: <span style="color:#e6db74">&#34;AWS::AccountId&#34;</span> },
</span><span style="display:block;width:100%;background-color:#3c3d38">									<span style="color:#e6db74">&#34;function&#34;</span>,
</span><span style="display:block;width:100%;background-color:#3c3d38">									<span style="color:#e6db74">&#34;workshopphotoprocessor&#34;</span>
</span><span style="display:block;width:100%;background-color:#3c3d38">									]
</span><span style="display:block;width:100%;background-color:#3c3d38">								]
</span><span style="display:block;width:100%;background-color:#3c3d38">							},
</span><span style="display:block;width:100%;background-color:#3c3d38">							<span style="color:#f92672">&#34;Event&#34;</span>: <span style="color:#e6db74">&#34;s3:ObjectCreated:Put&#34;</span>,
</span><span style="display:block;width:100%;background-color:#3c3d38">							<span style="color:#f92672">&#34;Filter&#34;</span>: {
</span><span style="display:block;width:100%;background-color:#3c3d38">								<span style="color:#f92672">&#34;S3Key&#34;</span>: {
</span><span style="display:block;width:100%;background-color:#3c3d38">									<span style="color:#f92672">&#34;Rules&#34;</span>: [ 
</span><span style="display:block;width:100%;background-color:#3c3d38">										{ <span style="color:#f92672">&#34;Name&#34;</span>: <span style="color:#e6db74">&#34;prefix&#34;</span>, <span style="color:#f92672">&#34;Value&#34;</span>: <span style="color:#e6db74">&#34;uploads/&#34;</span> }
</span><span style="display:block;width:100%;background-color:#3c3d38">									]
</span><span style="display:block;width:100%;background-color:#3c3d38">								}
</span><span style="display:block;width:100%;background-color:#3c3d38">							}
</span><span style="display:block;width:100%;background-color:#3c3d38">						}
</span><span style="display:block;width:100%;background-color:#3c3d38">					]
</span><span style="display:block;width:100%;background-color:#3c3d38">				}
</span>			}
		},
<span style="display:block;width:100%;background-color:#3c3d38">		<span style="color:#f92672">&#34;DenyListS3Buckets&#34;</span>: {
</span><span style="display:block;width:100%;background-color:#3c3d38">			<span style="color:#f92672">&#34;DependsOn&#34;</span>: [ <span style="color:#e6db74">&#34;S3Bucket&#34;</span> ],
</span><span style="display:block;width:100%;background-color:#3c3d38">			<span style="color:#f92672">&#34;Type&#34;</span>: <span style="color:#e6db74">&#34;AWS::IAM::Policy&#34;</span>,
</span><span style="display:block;width:100%;background-color:#3c3d38">			<span style="color:#f92672">&#34;Properties&#34;</span>: {
</span><span style="display:block;width:100%;background-color:#3c3d38">				<span style="color:#f92672">&#34;PolicyName&#34;</span>: <span style="color:#e6db74">&#34;DenyListS3Buckets&#34;</span>,
</span><span style="display:block;width:100%;background-color:#3c3d38">				<span style="color:#f92672">&#34;Roles&#34;</span>: [ { <span style="color:#f92672">&#34;Ref&#34;</span>: <span style="color:#e6db74">&#34;authRoleName&#34;</span> } ],
</span><span style="display:block;width:100%;background-color:#3c3d38">				<span style="color:#f92672">&#34;PolicyDocument&#34;</span>: {
</span><span style="display:block;width:100%;background-color:#3c3d38">					<span style="color:#f92672">&#34;Version&#34;</span>: <span style="color:#e6db74">&#34;2012-10-17&#34;</span>,
</span><span style="display:block;width:100%;background-color:#3c3d38">					<span style="color:#f92672">&#34;Statement&#34;</span>: [
</span><span style="display:block;width:100%;background-color:#3c3d38">						{
</span><span style="display:block;width:100%;background-color:#3c3d38">							<span style="color:#f92672">&#34;Effect&#34;</span>: <span style="color:#e6db74">&#34;Deny&#34;</span>,
</span><span style="display:block;width:100%;background-color:#3c3d38">							<span style="color:#f92672">&#34;Action&#34;</span>: [ <span style="color:#e6db74">&#34;s3:ListBucket&#34;</span> ],
</span><span style="display:block;width:100%;background-color:#3c3d38">							<span style="color:#f92672">&#34;Resource&#34;</span>: [<span style="color:#e6db74">&#34;*&#34;</span>]
</span><span style="display:block;width:100%;background-color:#3c3d38">						}
</span><span style="display:block;width:100%;background-color:#3c3d38">					]
</span><span style="display:block;width:100%;background-color:#3c3d38">				}
</span><span style="display:block;width:100%;background-color:#3c3d38">			}
</span><span style="display:block;width:100%;background-color:#3c3d38">		},
</span>		<span style="color:#f92672">&#34;S3UnauthPolicyRW&#34;</span>: {
			<span style="color:#f92672">&#34;Condition&#34;</span>: <span style="color:#e6db74">&#34;EnableUnauthReadWrite&#34;</span>,
			<span style="color:#f92672">&#34;DependsOn&#34;</span>: [
				<span style="color:#e6db74">&#34;S3Bucket&#34;</span>
			],
			<span style="color:#f92672">&#34;Type&#34;</span>: <span style="color:#e6db74">&#34;AWS::IAM::Policy&#34;</span>,
			<span style="color:#f92672">&#34;Properties&#34;</span>: {
				<span style="color:#f92672">&#34;PolicyName&#34;</span>: {
					<span style="color:#f92672">&#34;Ref&#34;</span>: <span style="color:#e6db74">&#34;authPolicyName&#34;</span>
				},
				<span style="color:#f92672">&#34;Roles&#34;</span>: [
					{
						<span style="color:#f92672">&#34;Ref&#34;</span>: <span style="color:#e6db74">&#34;unauthRoleName&#34;</span>
					}
				],
				<span style="color:#f92672">&#34;PolicyDocument&#34;</span>: {
					<span style="color:#f92672">&#34;Version&#34;</span>: <span style="color:#e6db74">&#34;2012-10-17&#34;</span>,
					<span style="color:#f92672">&#34;Statement&#34;</span>: [
						{
							<span style="color:#f92672">&#34;Effect&#34;</span>: <span style="color:#e6db74">&#34;Allow&#34;</span>,
							<span style="color:#f92672">&#34;Action&#34;</span>: [
								<span style="color:#e6db74">&#34;s3:GetObject&#34;</span>,
								<span style="color:#e6db74">&#34;s3:PutObject&#34;</span>,
								<span style="color:#e6db74">&#34;s3:DeleteObject&#34;</span>
							],
							<span style="color:#f92672">&#34;Resource&#34;</span>: [
								{
									<span style="color:#f92672">&#34;Fn::Join&#34;</span>: [
										<span style="color:#e6db74">&#34;&#34;</span>,
										[
											<span style="color:#e6db74">&#34;arn:aws:s3:::&#34;</span>,
											{
												<span style="color:#f92672">&#34;Ref&#34;</span>: <span style="color:#e6db74">&#34;S3Bucket&#34;</span>
											},
											<span style="color:#e6db74">&#34;/public/*&#34;</span>
										]
									]
								}
							]
						},
						{
							<span style="color:#f92672">&#34;Effect&#34;</span>: <span style="color:#e6db74">&#34;Allow&#34;</span>,
							<span style="color:#f92672">&#34;Action&#34;</span>: [
								<span style="color:#e6db74">&#34;s3:PutObject&#34;</span>
							],
							<span style="color:#f92672">&#34;Resource&#34;</span>: [
								{
									<span style="color:#f92672">&#34;Fn::Join&#34;</span>: [
										<span style="color:#e6db74">&#34;&#34;</span>,
										[
											<span style="color:#e6db74">&#34;arn:aws:s3:::&#34;</span>,
											{
												<span style="color:#f92672">&#34;Ref&#34;</span>: <span style="color:#e6db74">&#34;S3Bucket&#34;</span>
											},
											<span style="color:#e6db74">&#34;/uploads/*&#34;</span>
										]
									]
								}
							]
						},
						{
							<span style="color:#f92672">&#34;Effect&#34;</span>: <span style="color:#e6db74">&#34;Allow&#34;</span>,
							<span style="color:#f92672">&#34;Action&#34;</span>: [
								<span style="color:#e6db74">&#34;s3:GetObject&#34;</span>
							],
							<span style="color:#f92672">&#34;Resource&#34;</span>: [
								{
									<span style="color:#f92672">&#34;Fn::Join&#34;</span>: [
										<span style="color:#e6db74">&#34;&#34;</span>,
										[
											<span style="color:#e6db74">&#34;arn:aws:s3:::&#34;</span>,
											{
												<span style="color:#f92672">&#34;Ref&#34;</span>: <span style="color:#e6db74">&#34;S3Bucket&#34;</span>
											},
											<span style="color:#e6db74">&#34;/protected/*&#34;</span>
										]
									]
								}
							]
						},
						{
							<span style="color:#f92672">&#34;Effect&#34;</span>: <span style="color:#e6db74">&#34;Allow&#34;</span>,
							<span style="color:#f92672">&#34;Action&#34;</span>: [
								<span style="color:#e6db74">&#34;s3:ListBucket&#34;</span>
							],
							<span style="color:#f92672">&#34;Resource&#34;</span>: [
								{
									<span style="color:#f92672">&#34;Fn::Join&#34;</span>: [
										<span style="color:#e6db74">&#34;&#34;</span>,
										[
											<span style="color:#e6db74">&#34;arn:aws:s3:::&#34;</span>,
											{
												<span style="color:#f92672">&#34;Ref&#34;</span>: <span style="color:#e6db74">&#34;S3Bucket&#34;</span>
											}
										]
									]
								}
							],
							<span style="color:#f92672">&#34;Condition&#34;</span>: {
								<span style="color:#f92672">&#34;StringLike&#34;</span>: {
									<span style="color:#f92672">&#34;s3:prefix&#34;</span>: [
										<span style="color:#e6db74">&#34;public/&#34;</span>,
										<span style="color:#e6db74">&#34;public/*&#34;</span>,
										<span style="color:#e6db74">&#34;protected/&#34;</span>,
										<span style="color:#e6db74">&#34;protected/*&#34;</span>
									]
								}
							}
						}
					]
				}
			}
		},
		<span style="color:#f92672">&#34;S3UnauthPolicyR&#34;</span>: {
			<span style="color:#f92672">&#34;Condition&#34;</span>: <span style="color:#e6db74">&#34;EnableUnauthRead&#34;</span>,
			<span style="color:#f92672">&#34;DependsOn&#34;</span>: [
				<span style="color:#e6db74">&#34;S3Bucket&#34;</span>
			],
			<span style="color:#f92672">&#34;Type&#34;</span>: <span style="color:#e6db74">&#34;AWS::IAM::Policy&#34;</span>,
			<span style="color:#f92672">&#34;Properties&#34;</span>: {
				<span style="color:#f92672">&#34;PolicyName&#34;</span>: {
					<span style="color:#f92672">&#34;Ref&#34;</span>: <span style="color:#e6db74">&#34;authPolicyName&#34;</span>
				},
				<span style="color:#f92672">&#34;Roles&#34;</span>: [
					{
						<span style="color:#f92672">&#34;Ref&#34;</span>: <span style="color:#e6db74">&#34;unauthRoleName&#34;</span>
					}
				],
				<span style="color:#f92672">&#34;PolicyDocument&#34;</span>: {
					<span style="color:#f92672">&#34;Version&#34;</span>: <span style="color:#e6db74">&#34;2012-10-17&#34;</span>,
					<span style="color:#f92672">&#34;Statement&#34;</span>: [
						{
							<span style="color:#f92672">&#34;Effect&#34;</span>: <span style="color:#e6db74">&#34;Allow&#34;</span>,
							<span style="color:#f92672">&#34;Action&#34;</span>: [
								<span style="color:#e6db74">&#34;s3:ListBucket&#34;</span>
							],
							<span style="color:#f92672">&#34;Resource&#34;</span>: [
								{
									<span style="color:#f92672">&#34;Fn::Join&#34;</span>: [
										<span style="color:#e6db74">&#34;&#34;</span>,
										[
											<span style="color:#e6db74">&#34;arn:aws:s3:::&#34;</span>,
											{
												<span style="color:#f92672">&#34;Ref&#34;</span>: <span style="color:#e6db74">&#34;S3Bucket&#34;</span>
											}
										]
									]
								}
							],
							<span style="color:#f92672">&#34;Condition&#34;</span>: {
								<span style="color:#f92672">&#34;StringLike&#34;</span>: {
									<span style="color:#f92672">&#34;s3:prefix&#34;</span>: [
										<span style="color:#e6db74">&#34;public/&#34;</span>,
										<span style="color:#e6db74">&#34;public/*&#34;</span>,
										<span style="color:#e6db74">&#34;protected/&#34;</span>,
										<span style="color:#e6db74">&#34;protected/*&#34;</span>
									]
								}
							}
						},
						{
							<span style="color:#f92672">&#34;Effect&#34;</span>: <span style="color:#e6db74">&#34;Allow&#34;</span>,
							<span style="color:#f92672">&#34;Action&#34;</span>: [
								<span style="color:#e6db74">&#34;s3:GetObject&#34;</span>
							],
							<span style="color:#f92672">&#34;Resource&#34;</span>: [
								{
									<span style="color:#f92672">&#34;Fn::Join&#34;</span>: [
										<span style="color:#e6db74">&#34;&#34;</span>,
										[
											<span style="color:#e6db74">&#34;arn:aws:s3:::&#34;</span>,
											{
												<span style="color:#f92672">&#34;Ref&#34;</span>: <span style="color:#e6db74">&#34;S3Bucket&#34;</span>
											},
											<span style="color:#e6db74">&#34;/protected/*&#34;</span>
										]
									]
								},
								{
									<span style="color:#f92672">&#34;Fn::Join&#34;</span>: [
										<span style="color:#e6db74">&#34;&#34;</span>,
										[
											<span style="color:#e6db74">&#34;arn:aws:s3:::&#34;</span>,
											{
												<span style="color:#f92672">&#34;Ref&#34;</span>: <span style="color:#e6db74">&#34;S3Bucket&#34;</span>
											},
											<span style="color:#e6db74">&#34;/public/*&#34;</span>
										]
									]
								}
							]
						}
					]
				}
			}
		},
		<span style="color:#f92672">&#34;S3UnauthPolicyW&#34;</span>: {
			<span style="color:#f92672">&#34;Condition&#34;</span>: <span style="color:#e6db74">&#34;EnableUnauthWrite&#34;</span>,
			<span style="color:#f92672">&#34;DependsOn&#34;</span>: [
				<span style="color:#e6db74">&#34;S3Bucket&#34;</span>
			],
			<span style="color:#f92672">&#34;Type&#34;</span>: <span style="color:#e6db74">&#34;AWS::IAM::Policy&#34;</span>,
			<span style="color:#f92672">&#34;Properties&#34;</span>: {
				<span style="color:#f92672">&#34;PolicyName&#34;</span>: {
					<span style="color:#f92672">&#34;Ref&#34;</span>: <span style="color:#e6db74">&#34;authPolicyName&#34;</span>
				},
				<span style="color:#f92672">&#34;Roles&#34;</span>: [
					{
						<span style="color:#f92672">&#34;Ref&#34;</span>: <span style="color:#e6db74">&#34;unauthRoleName&#34;</span>
					}
				],
				<span style="color:#f92672">&#34;PolicyDocument&#34;</span>: {
					<span style="color:#f92672">&#34;Version&#34;</span>: <span style="color:#e6db74">&#34;2012-10-17&#34;</span>,
					<span style="color:#f92672">&#34;Statement&#34;</span>: [
						{
							<span style="color:#f92672">&#34;Effect&#34;</span>: <span style="color:#e6db74">&#34;Allow&#34;</span>,
							<span style="color:#f92672">&#34;Action&#34;</span>: [
								<span style="color:#e6db74">&#34;s3:PutObject&#34;</span>,
								<span style="color:#e6db74">&#34;s3:DeleteObject&#34;</span>
							],
							<span style="color:#f92672">&#34;Resource&#34;</span>: [
								{
									<span style="color:#f92672">&#34;Fn::Join&#34;</span>: [
										<span style="color:#e6db74">&#34;&#34;</span>,
										[
											<span style="color:#e6db74">&#34;arn:aws:s3:::&#34;</span>,
											{
												<span style="color:#f92672">&#34;Ref&#34;</span>: <span style="color:#e6db74">&#34;S3Bucket&#34;</span>
											},
											<span style="color:#e6db74">&#34;/public/*&#34;</span>
										]
									]
								}
							]
						},
						{
							<span style="color:#f92672">&#34;Effect&#34;</span>: <span style="color:#e6db74">&#34;Allow&#34;</span>,
							<span style="color:#f92672">&#34;Action&#34;</span>: [
								<span style="color:#e6db74">&#34;s3:PutObject&#34;</span>
							],
							<span style="color:#f92672">&#34;Resource&#34;</span>: [
								{
									<span style="color:#f92672">&#34;Fn::Join&#34;</span>: [
										<span style="color:#e6db74">&#34;&#34;</span>,
										[
											<span style="color:#e6db74">&#34;arn:aws:s3:::&#34;</span>,
											{
												<span style="color:#f92672">&#34;Ref&#34;</span>: <span style="color:#e6db74">&#34;S3Bucket&#34;</span>
											},
											<span style="color:#e6db74">&#34;/uploads/*&#34;</span>
										]
									]
								}
							]
						}
					]
				}
			}
		},
		<span style="color:#f92672">&#34;S3AuthPolicyRW&#34;</span>: {
			<span style="color:#f92672">&#34;Condition&#34;</span>: <span style="color:#e6db74">&#34;EnableAuthReadWrite&#34;</span>,
			<span style="color:#f92672">&#34;DependsOn&#34;</span>: [
				<span style="color:#e6db74">&#34;S3Bucket&#34;</span>
			],
			<span style="color:#f92672">&#34;Type&#34;</span>: <span style="color:#e6db74">&#34;AWS::IAM::Policy&#34;</span>,
			<span style="color:#f92672">&#34;Properties&#34;</span>: {
				<span style="color:#f92672">&#34;PolicyName&#34;</span>: {
					<span style="color:#f92672">&#34;Ref&#34;</span>: <span style="color:#e6db74">&#34;authPolicyName&#34;</span>
				},
				<span style="color:#f92672">&#34;Roles&#34;</span>: [
					{
						<span style="color:#f92672">&#34;Ref&#34;</span>: <span style="color:#e6db74">&#34;authRoleName&#34;</span>
					}
				],
				<span style="color:#f92672">&#34;PolicyDocument&#34;</span>: {
					<span style="color:#f92672">&#34;Version&#34;</span>: <span style="color:#e6db74">&#34;2012-10-17&#34;</span>,
					<span style="color:#f92672">&#34;Statement&#34;</span>: [
						{
							<span style="color:#f92672">&#34;Effect&#34;</span>: <span style="color:#e6db74">&#34;Allow&#34;</span>,
							<span style="color:#f92672">&#34;Action&#34;</span>: [
								<span style="color:#e6db74">&#34;s3:GetObject&#34;</span>,
								<span style="color:#e6db74">&#34;s3:PutObject&#34;</span>,
								<span style="color:#e6db74">&#34;s3:DeleteObject&#34;</span>
							],
							<span style="color:#f92672">&#34;Resource&#34;</span>: [
								{
									<span style="color:#f92672">&#34;Fn::Join&#34;</span>: [
										<span style="color:#e6db74">&#34;&#34;</span>,
										[
											<span style="color:#e6db74">&#34;arn:aws:s3:::&#34;</span>,
											{
												<span style="color:#f92672">&#34;Ref&#34;</span>: <span style="color:#e6db74">&#34;S3Bucket&#34;</span>
											},
											<span style="color:#e6db74">&#34;/public/*&#34;</span>
										]
									]
								},
								{
									<span style="color:#f92672">&#34;Fn::Join&#34;</span>: [
										<span style="color:#e6db74">&#34;&#34;</span>,
										[
											<span style="color:#e6db74">&#34;arn:aws:s3:::&#34;</span>,
											{
												<span style="color:#f92672">&#34;Ref&#34;</span>: <span style="color:#e6db74">&#34;S3Bucket&#34;</span>
											},
											<span style="color:#e6db74">&#34;/protected/${cognito-identity.amazonaws.com:sub}/*&#34;</span>
										]
									]
								},
								{
									<span style="color:#f92672">&#34;Fn::Join&#34;</span>: [
										<span style="color:#e6db74">&#34;&#34;</span>,
										[
											<span style="color:#e6db74">&#34;arn:aws:s3:::&#34;</span>,
											{
												<span style="color:#f92672">&#34;Ref&#34;</span>: <span style="color:#e6db74">&#34;S3Bucket&#34;</span>
											},
											<span style="color:#e6db74">&#34;/private/${cognito-identity.amazonaws.com:sub}/*&#34;</span>
										]
									]
								}
							]
						},
						{
							<span style="color:#f92672">&#34;Effect&#34;</span>: <span style="color:#e6db74">&#34;Allow&#34;</span>,
							<span style="color:#f92672">&#34;Action&#34;</span>: [
								<span style="color:#e6db74">&#34;s3:PutObject&#34;</span>
							],
							<span style="color:#f92672">&#34;Resource&#34;</span>: [
								{
									<span style="color:#f92672">&#34;Fn::Join&#34;</span>: [
										<span style="color:#e6db74">&#34;&#34;</span>,
										[
											<span style="color:#e6db74">&#34;arn:aws:s3:::&#34;</span>,
											{
												<span style="color:#f92672">&#34;Ref&#34;</span>: <span style="color:#e6db74">&#34;S3Bucket&#34;</span>
											},
											<span style="color:#e6db74">&#34;/uploads/*&#34;</span>
										]
									]
								}
							]
						},
						{
							<span style="color:#f92672">&#34;Effect&#34;</span>: <span style="color:#e6db74">&#34;Allow&#34;</span>,
							<span style="color:#f92672">&#34;Action&#34;</span>: [
								<span style="color:#e6db74">&#34;s3:GetObject&#34;</span>
							],
							<span style="color:#f92672">&#34;Resource&#34;</span>: [
								{
									<span style="color:#f92672">&#34;Fn::Join&#34;</span>: [
										<span style="color:#e6db74">&#34;&#34;</span>,
										[
											<span style="color:#e6db74">&#34;arn:aws:s3:::&#34;</span>,
											{
												<span style="color:#f92672">&#34;Ref&#34;</span>: <span style="color:#e6db74">&#34;S3Bucket&#34;</span>
											},
											<span style="color:#e6db74">&#34;/protected/*&#34;</span>
										]
									]
								}
							]
						},
						{
							<span style="color:#f92672">&#34;Effect&#34;</span>: <span style="color:#e6db74">&#34;Allow&#34;</span>,
							<span style="color:#f92672">&#34;Action&#34;</span>: [
								<span style="color:#e6db74">&#34;s3:ListBucket&#34;</span>
							],
							<span style="color:#f92672">&#34;Resource&#34;</span>: [
								{
									<span style="color:#f92672">&#34;Fn::Join&#34;</span>: [
										<span style="color:#e6db74">&#34;&#34;</span>,
										[
											<span style="color:#e6db74">&#34;arn:aws:s3:::&#34;</span>,
											{
												<span style="color:#f92672">&#34;Ref&#34;</span>: <span style="color:#e6db74">&#34;S3Bucket&#34;</span>
											}
										]
									]
								}
							],
							<span style="color:#f92672">&#34;Condition&#34;</span>: {
								<span style="color:#f92672">&#34;StringLike&#34;</span>: {
									<span style="color:#f92672">&#34;s3:prefix&#34;</span>: [
										<span style="color:#e6db74">&#34;public/&#34;</span>,
										<span style="color:#e6db74">&#34;public/*&#34;</span>,
										<span style="color:#e6db74">&#34;protected/&#34;</span>,
										<span style="color:#e6db74">&#34;protected/*&#34;</span>,
										<span style="color:#e6db74">&#34;private/${cognito-identity.amazonaws.com:sub}/&#34;</span>,
										<span style="color:#e6db74">&#34;private/${cognito-identity.amazonaws.com:sub}/*&#34;</span>
									]
								}
							}
						}
					]
				}
			}
		},
		<span style="color:#f92672">&#34;S3AuthPolicyR&#34;</span>: {
			<span style="color:#f92672">&#34;Condition&#34;</span>: <span style="color:#e6db74">&#34;EnableAuthRead&#34;</span>,
			<span style="color:#f92672">&#34;DependsOn&#34;</span>: [
				<span style="color:#e6db74">&#34;S3Bucket&#34;</span>
			],
			<span style="color:#f92672">&#34;Type&#34;</span>: <span style="color:#e6db74">&#34;AWS::IAM::Policy&#34;</span>,
			<span style="color:#f92672">&#34;Properties&#34;</span>: {
				<span style="color:#f92672">&#34;PolicyName&#34;</span>: {
					<span style="color:#f92672">&#34;Ref&#34;</span>: <span style="color:#e6db74">&#34;authPolicyName&#34;</span>
				},
				<span style="color:#f92672">&#34;Roles&#34;</span>: [
					{
						<span style="color:#f92672">&#34;Ref&#34;</span>: <span style="color:#e6db74">&#34;authRoleName&#34;</span>
					}
				],
				<span style="color:#f92672">&#34;PolicyDocument&#34;</span>: {
					<span style="color:#f92672">&#34;Version&#34;</span>: <span style="color:#e6db74">&#34;2012-10-17&#34;</span>,
					<span style="color:#f92672">&#34;Statement&#34;</span>: [
						{
							<span style="color:#f92672">&#34;Effect&#34;</span>: <span style="color:#e6db74">&#34;Allow&#34;</span>,
							<span style="color:#f92672">&#34;Action&#34;</span>: [
								<span style="color:#e6db74">&#34;s3:ListBucket&#34;</span>
							],
							<span style="color:#f92672">&#34;Resource&#34;</span>: [
								{
									<span style="color:#f92672">&#34;Fn::Join&#34;</span>: [
										<span style="color:#e6db74">&#34;&#34;</span>,
										[
											<span style="color:#e6db74">&#34;arn:aws:s3:::&#34;</span>,
											{
												<span style="color:#f92672">&#34;Ref&#34;</span>: <span style="color:#e6db74">&#34;S3Bucket&#34;</span>
											}
										]
									]
								}
							],
							<span style="color:#f92672">&#34;Condition&#34;</span>: {
								<span style="color:#f92672">&#34;StringLike&#34;</span>: {
									<span style="color:#f92672">&#34;s3:prefix&#34;</span>: [
										<span style="color:#e6db74">&#34;public/&#34;</span>,
										<span style="color:#e6db74">&#34;public/*&#34;</span>,
										<span style="color:#e6db74">&#34;protected/&#34;</span>,
										<span style="color:#e6db74">&#34;protected/*&#34;</span>
									]
								}
							}
						},
						{
							<span style="color:#f92672">&#34;Effect&#34;</span>: <span style="color:#e6db74">&#34;Allow&#34;</span>,
							<span style="color:#f92672">&#34;Action&#34;</span>: [
								<span style="color:#e6db74">&#34;s3:GetObject&#34;</span>
							],
							<span style="color:#f92672">&#34;Resource&#34;</span>: [
								{
									<span style="color:#f92672">&#34;Fn::Join&#34;</span>: [
										<span style="color:#e6db74">&#34;&#34;</span>,
										[
											<span style="color:#e6db74">&#34;arn:aws:s3:::&#34;</span>,
											{
												<span style="color:#f92672">&#34;Ref&#34;</span>: <span style="color:#e6db74">&#34;S3Bucket&#34;</span>
											},
											<span style="color:#e6db74">&#34;/protected/*&#34;</span>
										]
									]
								},
								{
									<span style="color:#f92672">&#34;Fn::Join&#34;</span>: [
										<span style="color:#e6db74">&#34;&#34;</span>,
										[
											<span style="color:#e6db74">&#34;arn:aws:s3:::&#34;</span>,
											{
												<span style="color:#f92672">&#34;Ref&#34;</span>: <span style="color:#e6db74">&#34;S3Bucket&#34;</span>
											},
											<span style="color:#e6db74">&#34;/public/*&#34;</span>
										]
									]
								}
							]
						}
					]
				}
			}
		},
		<span style="color:#f92672">&#34;S3AuthPolicyW&#34;</span>: {
			<span style="color:#f92672">&#34;Condition&#34;</span>: <span style="color:#e6db74">&#34;EnableAuthWrite&#34;</span>,
			<span style="color:#f92672">&#34;DependsOn&#34;</span>: [
				<span style="color:#e6db74">&#34;S3Bucket&#34;</span>
			],
			<span style="color:#f92672">&#34;Type&#34;</span>: <span style="color:#e6db74">&#34;AWS::IAM::Policy&#34;</span>,
			<span style="color:#f92672">&#34;Properties&#34;</span>: {
				<span style="color:#f92672">&#34;PolicyName&#34;</span>: {
					<span style="color:#f92672">&#34;Ref&#34;</span>: <span style="color:#e6db74">&#34;authPolicyName&#34;</span>
				},
				<span style="color:#f92672">&#34;Roles&#34;</span>: [
					{
						<span style="color:#f92672">&#34;Ref&#34;</span>: <span style="color:#e6db74">&#34;authRoleName&#34;</span>
					}
				],
				<span style="color:#f92672">&#34;PolicyDocument&#34;</span>: {
					<span style="color:#f92672">&#34;Version&#34;</span>: <span style="color:#e6db74">&#34;2012-10-17&#34;</span>,
					<span style="color:#f92672">&#34;Statement&#34;</span>: [
						{
							<span style="color:#f92672">&#34;Effect&#34;</span>: <span style="color:#e6db74">&#34;Allow&#34;</span>,
							<span style="color:#f92672">&#34;Action&#34;</span>: [
								<span style="color:#e6db74">&#34;s3:GetObject&#34;</span>,
								<span style="color:#e6db74">&#34;s3:PutObject&#34;</span>,
								<span style="color:#e6db74">&#34;s3:DeleteObject&#34;</span>
							],
							<span style="color:#f92672">&#34;Resource&#34;</span>: [
								{
									<span style="color:#f92672">&#34;Fn::Join&#34;</span>: [
										<span style="color:#e6db74">&#34;&#34;</span>,
										[
											<span style="color:#e6db74">&#34;arn:aws:s3:::&#34;</span>,
											{
												<span style="color:#f92672">&#34;Ref&#34;</span>: <span style="color:#e6db74">&#34;S3Bucket&#34;</span>
											},
											<span style="color:#e6db74">&#34;/public/*&#34;</span>
										]
									]
								},
								{
									<span style="color:#f92672">&#34;Fn::Join&#34;</span>: [
										<span style="color:#e6db74">&#34;&#34;</span>,
										[
											<span style="color:#e6db74">&#34;arn:aws:s3:::&#34;</span>,
											{
												<span style="color:#f92672">&#34;Ref&#34;</span>: <span style="color:#e6db74">&#34;S3Bucket&#34;</span>
											},
											<span style="color:#e6db74">&#34;/protected/${cognito-identity.amazonaws.com:sub}/*&#34;</span>
										]
									]
								},
								{
									<span style="color:#f92672">&#34;Fn::Join&#34;</span>: [
										<span style="color:#e6db74">&#34;&#34;</span>,
										[
											<span style="color:#e6db74">&#34;arn:aws:s3:::&#34;</span>,
											{
												<span style="color:#f92672">&#34;Ref&#34;</span>: <span style="color:#e6db74">&#34;S3Bucket&#34;</span>
											},
											<span style="color:#e6db74">&#34;/private/${cognito-identity.amazonaws.com:sub}/*&#34;</span>
										]
									]
								}
							]
						},
						{
							<span style="color:#f92672">&#34;Effect&#34;</span>: <span style="color:#e6db74">&#34;Allow&#34;</span>,
							<span style="color:#f92672">&#34;Action&#34;</span>: [
								<span style="color:#e6db74">&#34;s3:PutObject&#34;</span>
							],
							<span style="color:#f92672">&#34;Resource&#34;</span>: [
								{
									<span style="color:#f92672">&#34;Fn::Join&#34;</span>: [
										<span style="color:#e6db74">&#34;&#34;</span>,
										[
											<span style="color:#e6db74">&#34;arn:aws:s3:::&#34;</span>,
											{
												<span style="color:#f92672">&#34;Ref&#34;</span>: <span style="color:#e6db74">&#34;S3Bucket&#34;</span>
											},
											<span style="color:#e6db74">&#34;/uploads/*&#34;</span>
										]
									]
								}
							]
						},
						{
							<span style="color:#f92672">&#34;Effect&#34;</span>: <span style="color:#e6db74">&#34;Allow&#34;</span>,
							<span style="color:#f92672">&#34;Action&#34;</span>: [
								<span style="color:#e6db74">&#34;s3:GetObject&#34;</span>
							],
							<span style="color:#f92672">&#34;Resource&#34;</span>: [
								{
									<span style="color:#f92672">&#34;Fn::Join&#34;</span>: [
										<span style="color:#e6db74">&#34;&#34;</span>,
										[
											<span style="color:#e6db74">&#34;arn:aws:s3:::&#34;</span>,
											{
												<span style="color:#f92672">&#34;Ref&#34;</span>: <span style="color:#e6db74">&#34;S3Bucket&#34;</span>
											},
											<span style="color:#e6db74">&#34;/protected/*&#34;</span>
										]
									]
								}
							]
						},
						{
							<span style="color:#f92672">&#34;Effect&#34;</span>: <span style="color:#e6db74">&#34;Allow&#34;</span>,
							<span style="color:#f92672">&#34;Action&#34;</span>: [
								<span style="color:#e6db74">&#34;s3:ListBucket&#34;</span>
							],
							<span style="color:#f92672">&#34;Resource&#34;</span>: [
								{
									<span style="color:#f92672">&#34;Fn::Join&#34;</span>: [
										<span style="color:#e6db74">&#34;&#34;</span>,
										[
											<span style="color:#e6db74">&#34;arn:aws:s3:::&#34;</span>,
											{
												<span style="color:#f92672">&#34;Ref&#34;</span>: <span style="color:#e6db74">&#34;S3Bucket&#34;</span>
											}
										]
									]
								}
							],
							<span style="color:#f92672">&#34;Condition&#34;</span>: {
								<span style="color:#f92672">&#34;StringLike&#34;</span>: {
									<span style="color:#f92672">&#34;s3:prefix&#34;</span>: [
										<span style="color:#e6db74">&#34;public/&#34;</span>,
										<span style="color:#e6db74">&#34;public/*&#34;</span>,
										<span style="color:#e6db74">&#34;protected/&#34;</span>,
										<span style="color:#e6db74">&#34;protected/*&#34;</span>,
										<span style="color:#e6db74">&#34;private/${cognito-identity.amazonaws.com:sub}/&#34;</span>,
										<span style="color:#e6db74">&#34;private/${cognito-identity.amazonaws.com:sub}/*&#34;</span>
									]
								}
							}
						}
					]
				}
			}
		}
	},
	<span style="color:#f92672">&#34;Outputs&#34;</span>: {
		<span style="color:#f92672">&#34;BucketName&#34;</span>: {
			<span style="color:#f92672">&#34;Value&#34;</span>: {
				<span style="color:#f92672">&#34;Ref&#34;</span>: <span style="color:#e6db74">&#34;S3Bucket&#34;</span>
			},
			<span style="color:#f92672">&#34;Description&#34;</span>: <span style="color:#e6db74">&#34;Bucket name for the S3 bucket&#34;</span>
		},
		<span style="color:#f92672">&#34;Region&#34;</span>: {
			<span style="color:#f92672">&#34;Value&#34;</span>: {
				<span style="color:#f92672">&#34;Ref&#34;</span>: <span style="color:#e6db74">&#34;AWS::Region&#34;</span>
			}
		}
	}
}</code></pre></div>
</div></p></li>

<li><div class="notices warning" ><p>After you paste the new template shown above, find the text <strong>REPLACE_WITH_USERFILES_BUCKET_NAME</strong> in your pasted template and replace it with the name of your userfiles S3 bucket.
<br/>
<br/>
You can find this value in <strong>photo-albums/src/aws-exports.js</strong> under the <strong>aws_user_files_s3_bucket</strong> key.</p>
</div>
</li>

<li><p><strong>From the photo-albums directory, run:</strong> <code>amplify push</code> to update our storage configuration.</p></li>

<li><p>Wait for the update to complete. This step usually only takes a minute or two.</p></li>
</ol>

<h3 id="what-we-changed-in-amplify-s3-cloudformation-template-json">What we changed in amplify/&hellip;/s3-cloudformation-template.json</h3>

<ul>
<li><p>Added a <em>env</em> parameter, allowing Amplify to pass in the current Amplify environment name to the template</p></li>

<li><p>Added a <em>InvokePhotoProcessorLambda</em> resource, giving the S3Bucket permission to invoke the PhotoProcessor lambda function.</p></li>

<li><p>Added a <em>NotificationConfiguration</em> property to the S3Bucket resource, configuring the bucket to invoke our PhotoProcessor lambda function when new photos are added to the &lsquo;uploads/&rsquo; prefix</p></li>

<li><p>Added a <em>DenyListS3Buckets</em> IAM policy, preventing authenticated users from listing the contents of any buckets on S3</p></li>
</ul>

<div class="notices info" ><p>The default permissions for the user files S3 storage bucket set up by the Amplify CLI allows anyone logged in to our app to list the contents of the bucket for any keys that start with &lsquo;public/&rsquo; (and a few other prefixes too). While our app doesn&rsquo;t expose this as an interaction, someone poking around might try to take their credentials from our app and make an API call to S3 directly to try and list the bucket where all the photos are going.
<br/>
<br/>
We have no need to let users list bucket contents at all, so we&rsquo;ve added an IAM policy to the role used by authenticated users to explicitly deny users the ability to list any S3 bucket contents.
<br/>
<br/>
Now, nobody will be able to go directly to the S3 API and list all of the photos that our users have uploaded. We&rsquo;re using UUIDs for album and photo IDs, so we shouldn&rsquo;t have to worry about a curious user enumerating through patterns of IDs hoping to find photos to view.</p>
</div>


<h3 id="try-uploading-another-photo">Try uploading another photo</h3>

<p>With these changes completed, we should be able to upload a photo and see our Photo Processor function execute automatically. Try uploading a photo to an album, wait a moment, then refresh the page to see if the album renders the newly uploaded photo. If you see a photo, it means that our Photo Processor function was automatically triggered by the upload, it created a thumbnail, and it added all of the photo information to the DynamoDB table that our AppSync API reads from for resolving Photos.</p>

<p>Refreshing the album view in order to see new photos isn’t a great user experience, but this workshop has a lot of material already and there’s still more to cover in the next section, too. In short, one way to handle this with another AppSync subscription would be to have our photo processor Lambda function trigger a mutation on our AppSync API, and to have the AlbumDetailsLoader component subscribe to that mutation. However, because we’re using Amazon Cognito User Pool authentication for our AppSync API, the only way to have our Lambda function trigger such a mutation would be to create a sort of ‘system’ user (through the normal user sign up and confirmation process), store that user’s credentials securely (perhaps in AWS Secrets Manager), and authenticate to our AppSync API as that user inside our Lambda in order to trigger the mutation. For simplicity&rsquo;s sake, we&rsquo;ll stick to just refreshing the album view for this workshop.</p>


<footer class=" footline" >
	
</footer>


        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
        
        


        
            <a class="nav nav-prev" href="https://awskrug.github.io/amplify-photo-gallery-workshop/70_generating_thumbnails/10_creating_a_photo_processor_lambda.html" title="Creating a Photo Processor Lambda function"> <i class="fa fa-chevron-left"></i></a>
        
        
            <a class="nav nav-next" href="https://awskrug.github.io/amplify-photo-gallery-workshop/110_ai.html" title="Adding AI" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
        
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="https://awskrug.github.io/amplify-photo-gallery-workshop/js/clipboard.min.js?1554115494"></script>
    <script src="https://awskrug.github.io/amplify-photo-gallery-workshop/js/perfect-scrollbar.min.js?1554115494"></script>
    <script src="https://awskrug.github.io/amplify-photo-gallery-workshop/js/perfect-scrollbar.jquery.min.js?1554115494"></script>
    <script src="https://awskrug.github.io/amplify-photo-gallery-workshop/js/jquery.sticky.js?1554115494"></script>
    <script src="https://awskrug.github.io/amplify-photo-gallery-workshop/js/featherlight.min.js?1554115494"></script>
    <script src="https://awskrug.github.io/amplify-photo-gallery-workshop/js/html5shiv-printshiv.min.js?1554115494"></script>
    <script src="https://awskrug.github.io/amplify-photo-gallery-workshop/js/highlight.pack.js?1554115494"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="https://awskrug.github.io/amplify-photo-gallery-workshop/js/modernizr.custom.71422.js?1554115494"></script>
    <script src="https://awskrug.github.io/amplify-photo-gallery-workshop/js/learn.js?1554115494"></script>
    <script src="https://awskrug.github.io/amplify-photo-gallery-workshop/js/hugo-learn.js?1554115494"></script>

    <link href="https://awskrug.github.io/amplify-photo-gallery-workshop/mermaid/mermaid.css?1554115494" type="text/css" rel="stylesheet" />
    <script src="https://awskrug.github.io/amplify-photo-gallery-workshop/mermaid/mermaid.js?1554115494"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    

  </body>
</html>

